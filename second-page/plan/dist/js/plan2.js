const TitleModule={setTitle:e=>{document.querySelector(".plan__header-title").textContent=e},setSubtitle:e=>{document.querySelector(".plan__header-subtitle span").textContent=e}},ProgressBarModule={setProgressbar:(e,t,l,n="list")=>`\n            <svg class="plan__progressbar plan__progressbar_${n}" viewBox="0 0 1054 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n                \x3c!-- SVG код прогрессбара --\x3e\n            </svg>\n        `},ChartModule=(()=>{const e=(e,t,l,n)=>{const a={type:"line",data:{labels:setMonthsLine(n,t.currentMonth),datasets:[{backgroundColor:"#217AFF",borderColor:"#217AFF",data:t.annualStatistics}]},options:l},o=document.querySelector("."+e).getContext("2d");new Chart(o,a)};return{createChart:e,showChart:(t,l,n,a)=>{const o=n.find(e=>e.id==l);t.querySelector(".diagram-box_"+a).innerHTML=`<canvas class="line-chart-${l}"></canvas>`,e("line-chart-"+l,o,diagramOptions,diagramMounths)}}})(),ModalCoreModule=(()=>{const e=document.querySelector(".overlay"),t=document.querySelectorAll(".modal"),l=(document.querySelector(".modal_small"),document.querySelector(".modal_medium"),document.querySelector(".modal_large"),()=>{e.classList.remove("overlay_show"),t.forEach(e=>e.classList.remove("modal_show"))});return{closeModals:l,switchModals:(e,t,l)=>{e.classList.remove(l),t.classList.add(l)},init:()=>{e.addEventListener("click",l)}}})(),ModalPlaceModule=(()=>{const e=document.querySelector(".modal__place-wrapper"),t=["Кабинет ректора","Зал ученого совета","Белый зал","Малый зал"],l={placesFrame:'<svg class="modal__place-item__frame" viewBox="0 0 393 86" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M1.46459 23.5026L1.46459 23.0532L1.78612 22.7393L22.7861 2.2374L23.0969 1.93398L23.5313 1.93398L390.53 1.93399L391.597 1.93399L391.597 3.00063L391.598 62.1686L391.598 62.6105L391.285 62.9229L369.952 84.2562L369.64 84.5686L369.198 84.5686L2.53126 84.5686L1.46459 84.5686L1.46459 83.502L1.46459 23.5026Z" fill="#112054" fill-opacity="0.2" stroke="white" stroke-width="2.13333" />\n        </svg>'};return{init:()=>{((e,t,l,n)=>{let a="";e.map(e=>{a+=`<div class="modal__${n}-item" data-${n}="${e}">\n                <span>${e}</span>\n                ${t}\n            </div>`}),l.innerHTML=a})(t,l.placesFrame,e,"place");const n=document.querySelectorAll(".modal__place-item"),a=document.querySelectorAll(".modal__place-item__frame");var o,r,c;o=n,r="Белый зал",c="place",t.find((e,t)=>{e===r&&(o[t].classList.add(`modal__${c}-item_active`),o[t].querySelector(`.modal__${c}-item__frame`).classList.add("modal_show"))}),e.addEventListener("click",e=>{let t=e.target.closest("div");t.classList.contains("modal__place-item")&&((e,t,l,n,a="modal_show")=>{let o=`modal__${n}-item_active`;e.forEach(e=>e.classList.remove(o)),l.classList.add(o),t.forEach(e=>e.classList.remove(a)),l.querySelector("svg").classList.add(a)})(n,a,t,"place")})}}})(),ModalTimeModule=(()=>{const e=document.querySelector(".modal__timetable-wrapper"),t=["06:00","06:10","06:20","06:30","06:40","06:50","07:00","07:10","07:20","07:30","07:40","07:50"],l={timetableFrame:'<svg class="modal__timetable-item__frame" viewBox="0 0 113 58" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M1.06616 19L1.06616 18.5582L1.37858 18.2458L17.3786 2.24574L17.691 1.93332L18.1328 1.93332L110.132 1.93333L111.198 1.93333L111.198 2.99997L111.199 39L111.199 39.4123L110.922 39.7175L95.9221 56.2194L95.6047 56.5686L95.1328 56.5686L2.13281 56.5686L1.06615 56.5686L1.06615 55.502L1.06616 19Z" fill="#112054" fill-opacity="0.2" stroke="white" stroke-width="2.13333"/>\n        </svg>'};return{init:()=>{((e,t,l,n)=>{let a="";e.map(e=>{a+=`<div class="modal__${n}-item" data-${n}="${e}">\n                <span>${e}</span>\n                ${t}\n            </div>`}),l.innerHTML=a})(t,l.timetableFrame,e,"timetable");const n=document.querySelectorAll(".modal__timetable-item"),a=document.querySelectorAll(".modal__timetable-item__frame");var o,r,c;o=n,r="11:20",c="timetable",t.find((e,t)=>{e===r&&(o[t].classList.add(`modal__${c}-item_active`),o[t].querySelector(`.modal__${c}-item__frame`).classList.add("modal_show"))}),e.addEventListener("click",e=>{let t=e.target.closest("div");t.classList.contains("modal__timetable-item")&&((e,t,l,n,a="modal_show")=>{let o=`modal__${n}-item_active`;e.forEach(e=>e.classList.remove(o)),l.classList.add(o),t.forEach(e=>e.classList.remove(a)),l.querySelector("svg").classList.add(a)})(n,a,t,"timetable")})}}})(),ModalCalendarModule=(()=>{let e,t,l,n;const a=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],o=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],r=document.querySelector(".modal__calendar-body"),c=document.querySelectorAll(".modal__calendar-arrow__btn"),s=()=>{let t=o[e];document.querySelector(".modal__calendar-month").innerHTML=t},i=()=>{r.innerHTML="",(()=>{let l,a=[],o=0;a[o]=[];let r=new Date(t,e+1,0).getDate();for(let c=1;c<=r;c++)1!=new Date(t,e,c).getDay()?(l={index:c},l.index===n&&(l.mark="today"),a[o].push(l)):(o++,a[o]=[],l={index:c},a[o].push(l)),l.index===n&&(l.mark="today");if(a[0].length>0)for(let e=a[0].length;e<7;e++)a[0].unshift("");return a})().map(e=>{let t="<tr>";e.map((l,n)=>{let a=l.mark?"today":null;t+=`<td class="day-cell ${a}"> ${l.index?`<span>${l.index}</span>`:""}</td>`,e[n-1]==e.length&&(t+="</tr>")}),r.innerHTML+=t})},d=()=>{setTimeout(()=>{i(),m()},0)},_=l=>{l.classList.contains("increase")?(e++,e>11&&(e=0,t++),s(),d()):(e--,e<0&&(e=11,t--),s(),d())},m=()=>{r.querySelectorAll(".day-cell span").forEach(e=>e.addEventListener("click",()=>{var t;t=e.textContent,l.setDate(t),n=l.getDate(),d()}))};return{init:()=>{e=(new Date).getMonth(),t=(new Date).getFullYear(),l=new Date,n=(new Date).getDate(),(()=>{let e="";a.map(t=>{e+=`<td>${t}</td>`}),document.querySelector(".modal__calendar-days").innerHTML=e})(),s(),document.querySelector(".modal__calendar-year").innerHTML=t,i(),m(),c.forEach(e=>e.addEventListener("click",()=>_(e)))}}})(),ModalEventsModule=(()=>{const e=document.querySelector(".modal_small"),t=document.querySelector(".modal_medium"),l=document.querySelector(".modal_large"),n=l.querySelector(".modal__submit"),a=document.querySelectorAll(".modal__btn_confirm"),o=document.querySelectorAll(".modal__btn_cancelled"),r=document.querySelector(".modal__select-report"),c=document.querySelector(".modal__select-meeting");let s={type:"meeting",payload:{}};return{init:()=>{r.addEventListener("click",()=>{ModalCoreModule.switchModals(t,l,"modal_show")}),c.addEventListener("click",()=>{s.type="report",s.payload={},ModalCoreModule.switchModals(l,t,"modal_show")}),n.addEventListener("click",()=>{s.type="meeting",s.payload={},ModalCoreModule.switchModals(l,e,"modal_show")}),o.forEach(e=>{e.addEventListener("click",()=>ModalCoreModule.closeModals())}),a.forEach(e=>{e.addEventListener("click",()=>{ModalCoreModule.closeModals(),console.log(s)})})}}})(),MenuModule=(()=>{const e=e=>{let t=document.querySelector(".plan__tabcontent-block__wrap_menu"),l="";e.sort(SortModule.byField("fact")).map(e=>{l+=(e=>{const{name:t,color:l,id:n,plan:a,fact:o,isIcrease:r}=e;return`\n            <div class="plan__menu-block" data-id=${n}>\n                <svg class="plan__graphiс" width="100%" overflow="visible" viewBox="0 0 120 3" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <rect class="plan__graphiс-row" height="5%"  width="10%" fill="${l}" x="3" y="0.4" />\n                    <rect  class="plan__graphiс-right-rect" stroke="${l}" x="10%" y="0"  fill="white"/>\n                    <rect  class="plan__graphiс-left-rect" stroke="${l}" x="0" y="0" fill="transparent"/>\n                </svg>\n                <div class="plan__menu-block__wrap">\n                    <div class="plan__menu-block__descr">${t}</div>\n                </div>\n                <div class="plan__menu-block__info">\n                    ${ProgressBarModule.setProgressbar(n,o,r,"menu")}\n                    <div class="plan__menu-block__indicators">\n                        <div class="plan__menu-block__value">${o}%</div>\n                        <div class="plan__menu-block__current-plan">\n                            <span class="plan__menu-block__current-plan-value">${a}</span>\n                            <span class="plan__menu-block__current-plan-descr">тыс.руб.</span>\n                        </div>\n                    </div>\n                    <img class="plan__menu-block__alarm" data-id="${n}" src="../assets/img/plan-icons/alarm.svg">\n                </div> \n                <div class="diagram-box_menu"></div>\n            </div>\n        `})(e)}),t.innerHTML=l},t=e=>{const t=document.querySelectorAll(".plan__menu-block");let l=[];e.map(e=>{e.items?l.push(e.items.length):l.push(0)}),t.forEach((e,t)=>{let n=e.children[0].children[0],a=e.children[0].children[1],o=l[t]+10;o=o>10?o:10,o=o>90?o=90:o,n.setAttribute("width",o+"%"),a.setAttribute("x",o+"%")})};return{init:l=>{e(l),t(l);const n=document.querySelectorAll(".plan__menu-block"),a=document.querySelectorAll(".diagram-box_menu");n.forEach(e=>{e.addEventListener("click",(function(t){let o=+e.getAttribute("data-id");if("plan__menu-block__alarm"==t.target.className)ModalModule.openModal(o,l);else{document.querySelectorAll(".plan__menu-block").forEach(e=>{let t=e.children[0].children[0],l=e.children[0].children[1];t.setAttribute("width","10%"),l.setAttribute("x","10%")});let t=this.children[0].children[0],r=this.children[0].children[1],c=this.children[1].children[0].textContent;t.setAttribute("width","100%"),r.setAttribute("x","100%"),TitleModule.setTitle(c),ContentModule.setContent(SortModule.getSortData(l,o)),n.forEach(e=>e.classList.remove("plan__menu-block_opened")),a.forEach(e=>e.innerHTML=""),e.classList.add("plan__menu-block_opened"),ChartModule.showChart(e,o,l,"menu")}}))}),document.querySelector(".header__link_get-all-plan").addEventListener("click",()=>{ContentModule.setContent(SortModule.getSortData(l)),TitleModule.setTitle("План выполнения поступлений денежных средств по НИР"),t(l),n.forEach(e=>e.classList.remove("plan__menu-block_opened")),a.forEach(e=>e.innerHTML="")})}}})(),SortModule=(()=>{let e=[];const t=t=>{t.items.map(l=>{l.color=t.color,e.push(l)})},l=e=>(t,l)=>t[e]<l[e]?1:-1;return{byField:l,getSortData:(n,a)=>(e=[],void 0!==a?n.find(e=>{e.items&&e.id==a&&t(e)}):n.map(e=>{e.items&&t(e)}),TitleModule.setSubtitle(e.length),e.sort(l("fact")))}})(),PartnerModule={Partner:class{constructor(e,t){this.array=e,this.className="plan__tabcontent-block__wrap",this.modifier=t,this.parent=document.querySelector(".plan__tabcontent-block_"+this.modifier),this.count=this.array.length}bg(e){let t="";return e>0&&e<3&&(t="middle"),`\n                <svg class="plan__tabcontent-block__bg plan__tabcontent-block__bg_${t} hide" viewBox="0 0 1269 675" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    \x3c!-- SVG код фона --\x3e\n                </svg>\n            `}divider(){return'\n                <svg class="plan__tabcontent-block__divider" viewBox="0 0 800 39" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    \x3c!-- SVG код разделителя --\x3e\n                </svg>\n            '}createBlockItem(e,t){return`\n                <div class="plan__tabcontent-block__item" data-id="${e.id}">\n                    ${3===t?'<div class="diagram-box_list"></div>':""} \n                    ${this.bg(t)}\n                    <div class="plan__tabcontent-block__info">\n                        <svg class="plan__tabcontent-block__mark" width="100%" overflow="visible" viewBox="0 0 120 3" fill="none" xmlns="http://www.w3.org/2000/svg">\n                            <rect stroke="${e.color}" x="0" y="0" fill="white"/>\n                        </svg>\n                        <div class="plan__tabcontent-block__descr">${e.name}</div>\n                        <div class="plan__tabcontent-block__value">${e.fact}%</div>\n                    </div>\n                    ${ProgressBarModule.setProgressbar(this.modifier+"-"+t,Math.ceil(e.fact),e.isIncrease)}\n                    <div class="plan__tabcontent-block__info plan__tabcontent-block__info_bottom">\n                        ${this.divider()}\n                        <div class="plan__tabcontent-block__current-plan">\n                            <span class="plan__tabcontent-block__current-plan-value">${e.plan}</span>\n                            <span class="plan__tabcontent-block__current-plan-descr">тыс.руб.</span>\n                        </div>\n                    </div>\n                    ${t<=2?'<div class="diagram-box_list"></div>':""} \n                </div>\n            `}render(){const e=document.createElement("div");e.classList.add(this.className),this.array.length>3?e.classList.add(this.className):(e.classList.add(this.className),e.classList.add("plan__tabcontent-block__wrap_min-content"));let t="";this.array.forEach((e,l)=>t+=this.createBlockItem(e,l)),e.innerHTML="",e.innerHTML=t,this.parent.append(e)}renderEmptyBlock(){document.createElement("div").classList.add(this.className),this.parent.innerHTML=""}}},PaginationModule={init:()=>{}},ContentModule={setContent:e=>{let t=1,l=!0,n=[];const a=Math.ceil(e.length/8),o=(e,t,l)=>e.slice(t,l);setPages(a);const r=document.querySelectorAll(".plan__tabcontent");showCurrentPage(r);for(let e=1;e<=a;e++)n.push(btn(e));function c(e){document.querySelector(".plan__tabheader-btns").innerHTML="";let l=[];if(1!=a){if(2==e.length)t<a?l=e.slice(t-1,t+1):t==a&&(l=e.slice(t-2,t+1));else if(t<a-1)l=e.slice(t-1,t+2);else if(t<a)l=e.slice(t-2,t+1);else{if(t!=a)return;l=e.slice(t-3,t)}l.unshift(next),l.push(prev),document.querySelector(".plan__tabheader-btns").innerHTML=`\n                ${l.join("")}\n            `,document.querySelector(".plan__tabitem-next").addEventListener("click",s),document.querySelector(".plan__tabitem-prev").addEventListener("click",i),d()}}function s(){return l=!0,!(t>=n.length)&&1!=a&&void(a>1&&(t++,(t<n.length-1||l)&&c(n),document.querySelectorAll(".plan__tabitem-btn").forEach(e=>{e.classList.remove("plan__tabitem_active"),e.getAttribute("data-page")==t&&e.classList.add("plan__tabitem_active")}),showCurrentPage(r,t-1)))}function i(){if(l=!0,t<=1)return!1;t--,t<n.length-1&&c(n),document.querySelectorAll(".plan__tabitem-btn").forEach(e=>{e.classList.remove("plan__tabitem_active"),e.getAttribute("data-page")==t&&e.classList.add("plan__tabitem_active")}),showCurrentPage(r,t-1)}function d(){document.querySelectorAll(".plan__tabitem-btn").forEach(e=>{e.addEventListener("click",n=>{document.querySelectorAll(".plan__tabitem-btn").forEach(e=>{e.classList.remove("plan__tabitem_active")}),e.classList.add("plan__tabitem_active");let a=e.getAttribute("data-page");t=a,l=!1,showCurrentPage(r,t-1)})})}c(n),document.querySelector(".plan__tabheader").addEventListener("selectstart",()=>!1),d();for(let e=0;e<a;e++)r[e].innerHTML=setPage(e+1);!function(){if(count=0,0===a)for(let e=1;e<=a+1;e++)new Partner([],`p${e}-m`).renderEmptyBlock(),new Partner([],`p${e}-r`).renderEmptyBlock();else for(let t=1;t<=a;t++)new Partner(o(e,count,count+4),`p${t}-m`).render(),count+=4,new Partner(o(e,count,count+4),`p${t}-r`).render(),count+=4}();let _=document.querySelectorAll(".plan__tabcontent-block__item"),m=document.querySelectorAll(".diagram-box_list"),u=document.querySelectorAll(".plan__tabcontent-block__bg");_.forEach(e=>{e.addEventListener("click",()=>{let t=e.getAttribute("data-id"),l=e.querySelector(".plan__tabcontent-block__bg");u.forEach(e=>e.classList.remove("show")),l.classList.add("show"),m.forEach(e=>e.innerHTML=""),showChart(e,t,sortData,"list")})}),document.addEventListener("click",e=>{elem=e.target.className,"plan__wrapper"!=elem&&"plan__tabcontent-wrap"!=elem&&"plan__tabcontent-block__wrap plan__tabcontent-block__wrap_min-content"!=elem&&"plan__header-title"!=elem&&"plan__header"!=elem&&"subtitle"!=elem&&"plan__tabcontent plan__tabcontent_p1"!=elem||(u.forEach(e=>e.classList.remove("show")),m.forEach(e=>e.innerHTML=""))})}};document.addEventListener("DOMContentLoaded",()=>{TitleModule.setTitle("План выполнения поступлений денежных средств по НИР"),ChartModule.init(),ModalModule.init(),MenuModule.init(planData),SortModule.init(planData),PartnerModule.init(),ContentModule.init(planData)});